<UserControl x:Class="Astrolo.Explorer.UI.Profiling.ProfileEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:cm="http://caliburnmicro.com"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:astrolo="http://schemas.astrolo.org/"
             xmlns:astrology="clr-namespace:Astrolo.Astrology;assembly=Astrolo.Astrology"
             xmlns:geneKeys="clr-namespace:Astrolo.GeneKeys;assembly=Astrolo.GeneKeys"
             xmlns:behaviors="clr-namespace:Astrolo.Explorer.Behaviors"
             xmlns:converters="clr-namespace:Astrolo.Explorer.Converters"
             xmlns:mandala="clr-namespace:Astrolo.Explorer.UI.Visualisation.Mandala"
             xmlns:local="clr-namespace:Astrolo.Explorer.UI.Profiling"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance {x:Type local:ProfileEditorViewModel}, IsDesignTimeCreatable=false}">
    <DockPanel>
        <b:Interaction.Behaviors>
            <behaviors:SelectPointBehavior Command="{Binding SelectPointCommand}" />
        </b:Interaction.Behaviors>

        <DockPanel.Resources>

            <converters:EnumToStringConverter x:Key="EnumToStringConverter" />
            <system:Double x:Key="SphereSize">54</system:Double>

            <SolidColorBrush x:Key="DesignBrush" Color="Salmon"/>
            <SolidColorBrush x:Key="PersonalityBrush" Color="DimGray"/>

            <Style x:Key="ContainerStyle" TargetType="{x:Type ItemsControl}">
                <Setter Property="Focusable" Value="False" />
                <Setter Property="IsTabStop" Value="False" />
            </Style>

            <Style x:Key="ToolSeparatorStyle" TargetType="{x:Type Separator}" BasedOn="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}">
                <!--<Setter Property="Background" Value="Black"/>-->
            </Style>

            <Style TargetType="{x:Type HeaderedContentControl}">
                <Setter Property="Focusable" Value="False" />
                <Setter Property="IsTabStop" Value="False" />
                <Setter Property="Margin" Value="0,1.5" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type HeaderedContentControl}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition SharedSizeGroup="Label" Width="Auto" />
                                    <ColumnDefinition Width="5" />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>

                                <ContentPresenter Grid.Column="0" Content="{TemplateBinding Header}" TextElement.FontWeight="DemiBold" Opacity="0.7" />
                                <ContentPresenter Grid.Column="2" Content="{TemplateBinding Content}" />
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="CommaListStyle" TargetType="{x:Type ItemsControl}" BasedOn="{StaticResource ContainerStyle}">
                <Setter Property="AlternationCount" Value="999"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="ItemsPanel">
                    <Setter.Value>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal" IsItemsHost="True" VerticalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </Setter.Value>
                </Setter>
                <Setter Property="ItemTemplate">
                    <Setter.Value>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Name="Comma" Text=", "/>
                                <TextBlock>
                                    <Hyperlink Command="{Binding Path=DataContext.NavigateToGeneKeyCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                               CommandParameter="{Binding}"
                                               TextDecorations="None" Focusable="False">
                                        <Run Text="{Binding Mode=OneWay}"/>
                                    </Hyperlink>
                                </TextBlock>
                            </StackPanel>
                            <DataTemplate.Triggers>
                                <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                                    <Setter TargetName="Comma" Property="Visibility" Value="Collapsed"/>
                                </Trigger>
                            </DataTemplate.Triggers>
                        </DataTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <DataTemplate DataType="{x:Type astrology:ZodiacSign}">
                <StackPanel Orientation="Horizontal">
                    <astrolo:ZodiacIcon Sign="{Binding}" Fill="SteelBlue" Width="16" Height="16" Stretch="Uniform"/>
                    <TextBlock Text="{Binding Converter={StaticResource EnumToStringConverter}}" VerticalAlignment="Center" Margin="4,0,0,0"/>
                </StackPanel>
            </DataTemplate>
        </DockPanel.Resources>

        <ToolBar DockPanel.Dock="Top" ToolBarTray.IsLocked="True">
            <ToolBar.Resources>
                <Style x:Key="AspectIconStyle" TargetType="{x:Type Border}">
                    <Setter Property="BorderBrush" Value="#E0000000"/>
                    <Setter Property="BorderThickness" Value="2"/>
                    <Setter Property="Height" Value="18"/>
                    <Setter Property="Width" Value="18"/>
                    <Setter Property="CornerRadius" Value="2"/>
                    <Setter Property="UseLayoutRounding" Value="False"/>
                </Style>
            </ToolBar.Resources>

            <Button cm:Message.Attach="Clear" cm:Action.TargetWithoutContext="{Binding Editor}" Content="{iconPacks:Material Kind=FileDocumentOutline}" />

            <Separator Style="{StaticResource ToolSeparatorStyle}"/>

            <StackPanel Orientation="Horizontal">
                <RadioButton Style="{StaticResource MahApps.Styles.ToggleButton.ToolBar}" GroupName="Aspect"
                             IsChecked="{Binding ViewPersonalityAndDesign}" ToolTip="View All">
                    <Border Style="{StaticResource AspectIconStyle}">
                        <Border.Background>
                            <DrawingBrush Viewport="0,0,1,1" TileMode="Tile">
                                <DrawingBrush.Drawing>
                                    <DrawingGroup>
                                        <GeometryDrawing Brush="{StaticResource DesignBrush}">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="0,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                        <GeometryDrawing Brush="{StaticResource PersonalityBrush}">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="8,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingGroup>
                                </DrawingBrush.Drawing>
                            </DrawingBrush>
                        </Border.Background>
                    </Border>
                </RadioButton>
                <RadioButton Style="{StaticResource MahApps.Styles.ToggleButton.ToolBar}" GroupName="Aspect"
                             IsChecked="{Binding ViewDesignOnly}" ToolTip="Design Only">
                    <Border Style="{StaticResource AspectIconStyle}">
                        <Border.Background>
                            <DrawingBrush Viewport="0,0,1,1" TileMode="Tile">
                                <DrawingBrush.Drawing>
                                    <DrawingGroup>
                                        <GeometryDrawing Brush="{StaticResource DesignBrush}">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="0,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                        <GeometryDrawing Brush="White">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="8,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingGroup>
                                </DrawingBrush.Drawing>
                            </DrawingBrush>
                        </Border.Background>
                    </Border>
                </RadioButton>
                <RadioButton Style="{StaticResource MahApps.Styles.ToggleButton.ToolBar}" GroupName="Aspect"
                             IsChecked="{Binding ViewPersonalityOnly}" ToolTip="Personality Only">
                    <Border Style="{StaticResource AspectIconStyle}">
                        <Border.Background>
                            <DrawingBrush Viewport="0,0,1,1" TileMode="Tile">
                                <DrawingBrush.Drawing>
                                    <DrawingGroup>
                                        <GeometryDrawing Brush="White">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="0,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                        <GeometryDrawing Brush="{StaticResource PersonalityBrush}">
                                            <GeometryDrawing.Geometry>
                                                <RectangleGeometry Rect="8,0,8,8" />
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingGroup>
                                </DrawingBrush.Drawing>
                            </DrawingBrush>
                        </Border.Background>
                    </Border>
                </RadioButton>
            </StackPanel>

            <Separator Style="{StaticResource ToolSeparatorStyle}"/>

            <mah:ToggleSwitch IsOn="{Binding ShowStarPearl}" Focusable="False" Content="Show Star" Margin="6,0" />
        </ToolBar>

        <Grid Margin="10">
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="30" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="30" />
                    <ColumnDefinition Width="270"/>
                </Grid.ColumnDefinitions>

                <Grid VerticalAlignment="Top">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Grid.Resources>
                        <Style x:Key="GateTableStyle" TargetType="{x:Type ItemsControl}" BasedOn="{StaticResource ContainerStyle}">
                        </Style>

                        <Style x:Key="MarkerIconStyle" TargetType="{x:Type astrolo:MarkerIcon}">
                            <Setter Property="Width" Value="22" />
                            <Setter Property="HorizontalAlignment" Value="Center" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="Stretch" Value="Uniform" />
                            <Setter Property="StrokeThickness" Value="1.5" />
                            <Setter Property="StrokeLineJoin" Value="Round"/>
                            <Setter Property="StrokeStartLineCap" Value="Round" />
                            <Setter Property="StrokeEndLineCap" Value="Round" />
                        </Style>

                        <Style x:Key="PointEditorStyle" TargetType="{x:Type TextBox}" BasedOn="{StaticResource MahApps.Styles.TextBox}"
                               d:DataContext="{d:DesignInstance {x:Type local:ProfilePoint}, IsDesignTimeCreatable=false}">
                            <Setter Property="Width" Value="50" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="HorizontalContentAlignment" Value="Right" />
                            <Setter Property="mah:TextBoxHelper.SelectAllOnFocus" Value="True" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Marker}" Value="{x:Static astrology:Marker.Earth}">
                                    <Setter Property="IsReadOnly" Value="True"/>
                                    <Setter Property="IsTabStop" Value="False"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>

                        <Style x:Key="PointButtonStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource MahApps.Styles.Button.Chromeless}"
                               d:DataContext="{d:DesignInstance {x:Type local:ProfilePoint}, IsDesignTimeCreatable=false}">
                            <Setter Property="ToolTip" Value="{Binding Path=Marker, Converter={StaticResource EnumToStringConverter}}" />
                            <Setter Property="Focusable" Value="False" />
                            <Setter Property="IsTabStop" Value="False" />
                            <Setter Property="Command" Value="{x:Static astrolo:Commands.SelectPointCommand}" />
                            <Setter Property="CommandParameter" Value="{Binding}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="Transparent" />
                                    <Setter Property="Cursor" Value="Hand" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Resources>

                    <ItemsControl Grid.Column="0" Grid.IsSharedSizeScope="True"
                                  Style="{StaticResource GateTableStyle}" ItemsSource="{Binding Path=Editor.DesignPoints}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type local:ProfilePoint}">
                                <DockPanel Margin="0,2,0,3" >
                                    <Button Style="{StaticResource PointButtonStyle}">
                                        <astrolo:MarkerIcon x:Name="Icon" Marker="{Binding Marker}" Style="{StaticResource MarkerIconStyle}" />
                                    </Button>
                                    <TextBox Text="{Binding ValueAsText, ValidatesOnDataErrors=True, Delay=100}"
                                             Style="{StaticResource PointEditorStyle}" Margin="6,0,0,0" HorizontalAlignment="Left" />
                                </DockPanel>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsDesign}" Value="True">
                                        <Setter TargetName="Icon" Property="Stroke" Value="{StaticResource DesignBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsDesign}" Value="False">
                                        <Setter TargetName="Icon" Property="Stroke" Value="{StaticResource PersonalityBrush}"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Grid Grid.Column="1" Visibility="{Binding Path=Editor.IsComplete, Converter={converters:ObjectToVisibilityConverter HiddenOnly=True}}"
                          Margin="10,0">

                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="10"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Viewbox Stretch="Uniform">
                            <astrolo:BodyGraph Chart="{Binding FilteredChart}" Design="{StaticResource DesignBrush}" Personality="{StaticResource PersonalityBrush}" />
                        </Viewbox>

                        <StackPanel Grid.Row="2" Orientation="Vertical" DataContext="{Binding FilteredChart}" Grid.IsSharedSizeScope="True">
                            <HeaderedContentControl Header="Profile" Content="{Binding Type}"/>
                            <HeaderedContentControl Header="Authority" Content="{Binding Path=Centers.Authority}"/>
                            <HeaderedContentControl Header="Definition" Content="{Binding Definition}"/>
                            <HeaderedContentControl Header="Incarnation Cross" Content="{Binding IncarnationCross}"/>
                            <HeaderedContentControl Header="Channels">
                                <ItemsControl ItemsSource="{Binding CompleteChannels}" Style="{StaticResource ContainerStyle}">
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="{x:Type ContentPresenter}">
                                            <Setter Property="Margin" Value="0,0,10,0"/>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel Orientation="Vertical" IsItemsHost="True" Height="70"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </HeaderedContentControl>
                        </StackPanel>
                    </Grid>

                    <ItemsControl Grid.Column="2" Style="{StaticResource GateTableStyle}" ItemsSource="{Binding Path=Editor.PersonalityPoints}" >
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="{x:Type local:ProfilePoint}">
                                <DockPanel Margin="0,2,0,3">
                                    <TextBox Text="{Binding ValueAsText, ValidatesOnDataErrors=True, Delay=100}"
                                             Style="{StaticResource PointEditorStyle}" Margin="0,0,6,0" HorizontalAlignment="Left" />
                                    <Button Style="{StaticResource PointButtonStyle}">
                                        <astrolo:MarkerIcon x:Name="Icon" Marker="{Binding Marker}" Style="{StaticResource MarkerIconStyle}" />
                                    </Button>
                                </DockPanel>
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding IsDesign}" Value="True">
                                        <Setter TargetName="Icon" Property="Stroke" Value="{StaticResource DesignBrush}"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsDesign}" Value="False">
                                        <Setter TargetName="Icon" Property="Stroke" Value="DimGray"/>
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>

                <astrolo:SpacingPanel Grid.Column="4" Orientation="Vertical" Grid.IsSharedSizeScope="True"
                                      Visibility="{Binding SelectedHexagram, Converter={converters:ObjectToVisibilityConverter HiddenOnly=True}}">
                    <DockPanel>
                        <astrolo:HexagramShape Hexagram="{Binding SelectedHexagram}" Fill="SteelBlue" Width="46" Height="56" VerticalAlignment="Top" Margin="0,0,8,0" />
                        <mah:SplitButton DockPanel.Dock="Top" ItemsSource="{Binding GeneKeys}" SelectedItem="{Binding SelectedGeneKey}" DisplayMemberPath="Hexagram"
                                         FontSize="14" FontWeight="SemiBold" BorderThickness="0" HorizontalContentAlignment="Left"
                                         Command="{Binding NavigateToGeneKeyDetailCommand}" CommandParameter="{Binding Path=SelectedGeneKey.InfoLink}"
                                         ToolTip="{Binding Path=SelectedGeneKey.InfoLink}" />
                        <TextBlock Margin="4,0,0,0">
                            <Run Text="{Binding Path=SelectedHexagram.UpperTrigram, Mode=OneWay}" /><LineBreak/>
                            <Run Text="{Binding Path=SelectedHexagram.LowerTrigram, Mode=OneWay}" />
                        </TextBlock>
                    </DockPanel>

                    <StackPanel Orientation="Vertical">
                        <HeaderedContentControl Header="Siddhi" Content="{Binding Path=SelectedGeneKey.Siddhi}"/>
                        <HeaderedContentControl Header="Gift" Content="{Binding Path=SelectedGeneKey.Gift}"/>
                        <HeaderedContentControl Header="Shadow" Content="{Binding Path=SelectedGeneKey.Shadow}"/>

                        <HeaderedContentControl Header="Repressive" Content="{Binding Path=SelectedGeneKey.Repressive}"/>
                        <HeaderedContentControl Header="Reactive" Content="{Binding Path=SelectedGeneKey.Reactive}"/>
                        <HeaderedContentControl Header="Dilemma" Content="{Binding Path=SelectedGeneKey.Dilemma}"/>
                        <HeaderedContentControl Header="Victim State" Content="{Binding Path=SelectedGeneKey.VictimState}"/>

                        <HeaderedContentControl Header="Prog. Partner">
                            <TextBlock>
                                <Hyperlink Command="{Binding NavigateToProgrammingPartnerCommand}"
                                           TextDecorations="None" Focusable="False">
                                    <Run Text="{Binding Path=SelectedGeneKey.ProgrammingPartner.Number, Mode=OneWay}"/>
                                </Hyperlink>
                            </TextBlock>
                        </HeaderedContentControl>

                        <HeaderedContentControl Header="Codon Ring">
                            <TextBlock>
                                <Run Text="{Binding Path=SelectedGeneKey.CodonRing.Name, Mode=OneTime}"/>
                                    (<InlineUIContainer BaselineAlignment="TextBottom">
                                        <ItemsControl Style="{StaticResource CommaListStyle}" ItemsSource="{Binding Path=SelectedGeneKey.CodonRing.Sequence}"/>
                                    </InlineUIContainer>)
                            </TextBlock>
                        </HeaderedContentControl>

                        <HeaderedContentControl Header="Arcana" Content="{Binding Path=SelectedGeneKey.CodonRing.ArcanaArchetype}"/>

                        <HeaderedContentControl Header="Center" Content="{Binding Path=SelectedGate.Center, Converter={StaticResource EnumToStringConverter}}"/>
                        <HeaderedContentControl Header="Gate" Content="{Binding Path=SelectedGate.Name}"/>

                        <HeaderedContentControl Header="Channel">
                            <TextBlock>
                                <InlineUIContainer BaselineAlignment="TextBottom">
                                    <ItemsControl ItemsSource="{Binding Path=SelectedGate.Channels}" Focusable="False"  ItemStringFormat="g"/>
                                </InlineUIContainer>
                            </TextBlock>
                        </HeaderedContentControl>

                        <HeaderedContentControl Header="Circuit" Content="{Binding Path=SelectedGate.Circuit}"/>

                        <HeaderedContentControl Header="Harmonic">
                            <TextBlock>
                                <InlineUIContainer BaselineAlignment="TextBottom">
                                    <ItemsControl Style="{StaticResource CommaListStyle}" ItemsSource="{Binding Path=SelectedGate.Harmonics}"/>
                                </InlineUIContainer>
                            </TextBlock>
                        </HeaderedContentControl>

                        <HeaderedContentControl Header="Sign" Content="{Binding Path=SelectedGate.MandalaSlice.Sign}" />
                    </StackPanel>
                </astrolo:SpacingPanel>

                <Viewbox Grid.Row="0" Grid.Column="2" Stretch="Uniform" VerticalAlignment="Top">
                    <Grid>
                        <Grid.Resources>
                            <DataTemplate x:Key="GeneKeyToolTipTemplate" DataType="{x:Type geneKeys:IGeneKey}">
                                <astrolo:SpacingPanel Orientation="Vertical" Width="150" Spacing="4">
                                    <TextBlock Text="{Binding Hexagram}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Hexagram, StringFormat=t}" Foreground="Gainsboro"/>
                                    <TextBlock FontStyle="Italic">
                                        <Run Text="{Binding Siddhi, Mode=OneTime}" Foreground="#FF20487C"/><LineBreak/>
                                        <Run Text="{Binding Gift, Mode=OneTime}" Foreground="#FF76933C"/><LineBreak/>
                                        <Run Text="{Binding Shadow, Mode=OneTime}" Foreground="#FFB8B8A8"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding ProgrammingPartner.Number, StringFormat={}Prog. Partner {0}}" />
                                    <TextBlock Text="{Binding CodonRing, StringFormat=R, Mode=OneTime}" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Path=Gate.Center, Converter={StaticResource EnumToStringConverter}}" />
                                    <TextBlock Text="{Binding Path=Gate, Mode=OneTime, Converter={StaticResource EnumToStringConverter}}" Width="150"
                                               TextAlignment="Left" TextWrapping="Wrap"/>
                                </astrolo:SpacingPanel>
                            </DataTemplate>

                            <DataTemplate x:Key="GeneKeyToolPointTipTemplate" DataType="{x:Type local:GeneKeyPoint}">
                                <astrolo:SpacingPanel Orientation="Vertical" Width="150" Spacing="8">
                                    <ContentPresenter Content="{Binding GeneKey}" ContentTemplate="{StaticResource GeneKeyToolTipTemplate}"/>
                                    <ContentPresenter Content="{Binding Path=LineInfo.MandalaSlice.Sign}" />
                                </astrolo:SpacingPanel>
                            </DataTemplate>

                            <DataTemplate x:Key="SphereButtonTemplate" DataType="{x:Type local:GeneKeyPoint}">
                                <RadioButton GroupName="Path" Foreground="SteelBlue"
                                             IsChecked="{Binding IsSelected}" IsEnabled="{Binding IsEnabled}" FocusVisualStyle="{x:Null}" IsTabStop="False"
                                             Command="{x:Static astrolo:Commands.SelectPointCommand}" CommandParameter="{Binding ChartValue, Mode=OneTime}">
                                    <RadioButton.Template>
                                        <ControlTemplate TargetType="{x:Type RadioButton}">
                                            <Grid>
                                                <Grid.ToolTip>
                                                    <ToolTip d:DataContext="{d:DesignInstance {x:Type local:GeneKeyPoint}, IsDesignTimeCreatable=false}"
                                                             Content="{Binding}" ContentTemplate="{StaticResource GeneKeyToolPointTipTemplate}" />
                                                </Grid.ToolTip>
                                                <Ellipse>
                                                    <Ellipse.Fill>
                                                        <RadialGradientBrush >
                                                            <GradientStop Color="White"  />
                                                            <GradientStop Color="SteelBlue" Offset="0.94" />
                                                            <GradientStop Color="SteelBlue" Offset="1" />
                                                        </RadialGradientBrush>
                                                    </Ellipse.Fill>
                                                </Ellipse>
                                                <Ellipse Margin="1" StrokeThickness="1.5" Stroke="White" Opacity="0.8"
                                                         Visibility="{TemplateBinding IsMouseOver, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                <TextBlock Foreground="{TemplateBinding Foreground}" TextAlignment="Center" VerticalAlignment="Center">
                                                    <Run Text="{Binding Sphere, Mode=OneWay, Converter={StaticResource EnumToStringConverter}}" FontSize="9" />
                                                    <LineBreak/>
                                                    <Run Text="{Binding Mode=OneWay}" FontWeight="SemiBold" FontSize="14"/>
                                                </TextBlock>
                                                <Ellipse x:Name="DisableOverlay" Fill="White" Opacity="0" Margin="-1"/>
                                                <!--<Ellipse Stroke="#FF202020" StrokeThickness="1" StrokeDashArray="1 1.5" SnapsToDevicePixels="False"
                                                                         Visibility="{TemplateBinding IsKeyboardFocused, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="-3"/>-->
                                                <astrolo:WingPanel Visibility="{Binding IsEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <TextBlock Margin="3,7" TextElement.FontSize="9" IsHitTestVisible="False">
                                                        <TextBlock.Style>
                                                            <Style TargetType="{x:Type TextBlock}">
                                                                <Setter Property="TextAlignment" Value="Right"/>
                                                                <!--<Setter Property="Typography.Capitals" Value="SmallCaps"/>-->
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Sphere}" Value="Radiance">
                                                                        <Setter Property="TextAlignment" Value="Left"/>
                                                                        <Setter Property="astrolo:WingPanel.Placement" Value="Right"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                        <Run Text="{Binding Path=GeneKey.Siddhi, Mode=OneTime}" FontWeight="Bold"/><LineBreak/>
                                                        <Run Text="{Binding Path=GeneKey.Gift, Mode=OneTime}" /><LineBreak/>
                                                        <Run Text="{Binding Path=GeneKey.Shadow, Mode=OneTime}" /><LineBreak/>
                                                        <Run Text="{Binding Path=LineNote, Mode=OneTime}" Foreground="LightGray" FontSize="8" />
                                                    </TextBlock>
                                                </astrolo:WingPanel>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Trigger.EnterActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="DisableOverlay" Storyboard.TargetProperty="Opacity" To="0.8" Duration="0:0:0.2"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.EnterActions>
                                                    <Trigger.ExitActions>
                                                        <BeginStoryboard>
                                                            <Storyboard>
                                                                <DoubleAnimation Storyboard.TargetName="DisableOverlay" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.2"/>
                                                            </Storyboard>
                                                        </BeginStoryboard>
                                                    </Trigger.ExitActions>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </RadioButton.Template>
                                </RadioButton>
                            </DataTemplate>
                        </Grid.Resources>


                        <astrolo:ConcentricPanel Width="660" Height="660">
                            <astrolo:HaloSpokeWheel StartAngle="{Binding StartAngle, Mode=OneTime}" Spokes="64" StrokeThickness="1" Stroke="WhiteSmoke"/>

                            <astrolo:ConcentricPanel Band="3" Thickness="3" />
                            <astrolo:ZodiacRing astrolo:ConcentricPanel.Band="4" Padding="3" IconSize="14" Thickness="20" />
                            <astrolo:HaloDisc astrolo:ConcentricPanel.Band="5" Fill="White" astrolo:ConcentricPanel.Thickness="30" />

                            <ItemsControl Style="{StaticResource ContainerStyle}" ItemsSource="{Binding MandalaFigures}"
                                              astrolo:ConcentricPanel.Thickness="30" astrolo:ConcentricPanel.Band="0">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <astrolo:OrbitPanel IsItemsHost="True" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="{x:Type ContentPresenter}" d:Style.DataContext="{d:DesignInstance {x:Type mandala:MandalaFigure}}">
                                        <Setter Property="astrolo:OrbitPanel.Angle" Value="{Binding StartAngle, Mode=OneTime}"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="{x:Type mandala:MandalaFigure}">
                                        <Button BorderThickness="1" Focusable="False" IsTabStop="False" Padding="1"
                                                        Command="{x:Static astrolo:Commands.SelectPointCommand}" CommandParameter="{Binding GeneKey, Mode=OneTime}">
                                            <Button.ToolTip>
                                                <ToolTip Content="{Binding GeneKey}" ContentTemplate="{StaticResource GeneKeyToolTipTemplate}"/>
                                            </Button.ToolTip>
                                            <Button.Template>
                                                <ControlTemplate TargetType="{x:Type Button}">
                                                    <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="{TemplateBinding BorderBrush}">
                                                        <astrolo:HexagramShape x:Name="Icon" Width="19" Height="22" UseLayoutRounding="True" Spacer="0.2"
                                                                               Hexagram="{Binding Hexagram, Mode=OneTime}" />
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="False">
                                                            <Setter TargetName="Icon" Property="Fill" Value="Gainsboro"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter TargetName="Icon" Property="Fill" Value="SteelBlue"/>
                                                        </DataTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                            <Button.Style>
                                                <Style TargetType="{x:Type Button}">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Setter Property="BorderBrush" Value="Transparent"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="WhiteSmoke"/>
                                                            <Setter Property="BorderBrush" Value="Gainsboro"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Grid HorizontalAlignment="Center"  VerticalAlignment="Center" astrolo:ConcentricPanel.Band="6" SnapsToDevicePixels="False">
                                <Grid.Resources>
                                    <SolidColorBrush x:Key="ActivationBrush" Color="#FFD8E6AD"/>
                                    <SolidColorBrush x:Key="VenusBrush" Color="#FFD8ADE6"/>
                                    <SolidColorBrush x:Key="PearlBrush" Color="LightBlue"/>

                                    <Style TargetType="{x:Type astrolo:PathwayPath}">
                                        <Setter Property="SphereSize" Value="{StaticResource SphereSize}"/>
                                        <Setter Property="StrokeThickness" Value="6"/>
                                        <Setter Property="ToolTip" Value="{Binding Pathway, RelativeSource={RelativeSource Self}}"/>
                                        <Setter Property="Opacity" Value="0.2"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Opacity" Value="0.75"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>

                                    <Style TargetType="{x:Type astrolo:GoldenPath}">
                                        <Setter Property="SphereSize" Value="{StaticResource SphereSize}"/>
                                        <Setter Property="StrokeThickness" Value="2"/>
                                        <Setter Property="ToolTip">
                                            <Setter.Value>
                                                <ToolTip Content="{Binding Path=PlacementTarget.Sequence, RelativeSource={RelativeSource Self}}"
                                                                 ContentStringFormat="{}{0} Sequence"/>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="StrokeThickness" Value="8"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Resources>

                                <astrolo:PathwayPath Stroke="{StaticResource ActivationBrush}" Pathway="Challenge"  />
                                <astrolo:PathwayPath Stroke="{StaticResource ActivationBrush}" Pathway="Breakthrough" />
                                <astrolo:PathwayPath Stroke="{StaticResource ActivationBrush}" Pathway="CoreStability" />

                                <astrolo:PathwayPath Stroke="{StaticResource VenusBrush}" Pathway="Dharma" />
                                <astrolo:PathwayPath Stroke="{StaticResource VenusBrush}" Pathway="Karma" />
                                <astrolo:PathwayPath Stroke="{StaticResource VenusBrush}" Pathway="Intelligence" />
                                <astrolo:PathwayPath Stroke="{StaticResource VenusBrush}" Pathway="Love" />
                                <astrolo:PathwayPath Stroke="{StaticResource VenusBrush}" Pathway="Realisation" />

                                <astrolo:PathwayPath Stroke="{StaticResource PearlBrush}" Pathway="Initiative" />
                                <astrolo:PathwayPath Stroke="{StaticResource PearlBrush}" Pathway="Growth" />
                                <astrolo:PathwayPath Stroke="{StaticResource PearlBrush}" Pathway="Service" />
                                <astrolo:PathwayPath Stroke="{StaticResource PearlBrush}" Pathway="Quantum" />

                                <astrolo:GoldenPath Sequence="Activation" Stroke="{StaticResource ActivationBrush}" />
                                <astrolo:GoldenPath Sequence="Venus" Stroke="{StaticResource VenusBrush}" />
                                <astrolo:GoldenPath Sequence="Pearl" Stroke="{StaticResource PearlBrush}" />
                                <astrolo:GoldenPath Sequence="StarPearl" Stroke="PaleGoldenrod" Visibility="{Binding ShowStarPearl, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                <ItemsControl ItemsSource="{Binding Points}" Style="{StaticResource ContainerStyle}"
                                              ItemTemplate="{StaticResource SphereButtonTemplate}">
                                    <ItemsControl.ItemContainerStyle>
                                        <Style TargetType="{x:Type ContentPresenter}">
                                            <Setter Property="astrolo:GoldenPathPanel.Point" Value="{Binding Sphere}"/>
                                        </Style>
                                    </ItemsControl.ItemContainerStyle>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <astrolo:GoldenPathPanel IsItemsHost="True" SphereSize="{StaticResource SphereSize}"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </Grid>
                        </astrolo:ConcentricPanel>
                    </Grid>
                </Viewbox>
            </Grid>
        </Grid>
    </DockPanel>
</UserControl>
